<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
body{
  background:#1e1f22;
  color:white;
  font-family:Arial;
}

/* === –ü–ï–†–ï–ú–ò–ö–ê–ß –ú–û–í–ò (–ü–û –¶–ï–ù–¢–†–£ –ó–í–ï–†–•–£) === */
.lang-switcher{
  position:absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:6px;
}
.lang-switcher button{
  background:#2b2d31;
  color:white;
  border:1px solid #555;
  padding:5px 8px;
  border-radius:6px;
  cursor:pointer;
}

/* === –ë–õ–û–ö –Ü–ú–ü–û–†–¢/–ï–ö–°–ü–û–†–¢ === */
.top-right-tools{
  position:absolute;
  top:10px;
  right:10px;
  display:flex;
  gap:6px;
}

.top-right-tools button{
  background:#2b2d31;
  color:white;
  border:1px solid #555;
  padding:5px 8px;
  border-radius:6px;
  cursor:pointer;
}

/* –ö–Ω–æ–ø–∫–∏ –≤–∫–ª–∞–¥–æ–∫ */
.tabs{
  display:flex;
  gap:6px;
  margin-bottom:8px;
}

.tabs button{
  background:#2b2d31;
  color:white;
  border:1px solid #555;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
}

.tabs button.active{
  background:#3b3f45;
  border-color:#7dd3fc;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –≤–∫–ª–∞–¥–æ–∫ */
.tab-content{
  display:none;
  border:1px solid #666;
  border-radius:8px;
  padding:6px;
  background:#24262a;
  min-height:500px;
}
</style>
</head>
<body>

<h3>–õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h3>

<!-- ===== –ü–ï–†–ï–ú–ò–ö–ê–ß –ú–û–í–ò ===== -->
<div class="lang-switcher">
  <button onclick="setLang('ua')">üá∫üá¶ UA</button>
  <button onclick="setLang('ru')">üá∑üá∫ RU</button>
</div>

<div class="top-right-tools">
  <button id="exportBtn">üì§ –ï–∫—Å–ø–æ—Ä—Ç</button>
  <button id="importBtn">üì• –Ü–º–ø–æ—Ä—Ç</button>
  <input type="file" id="importFile" accept=".json" style="display:none;">
</div>

<div class="tabs">
  <button data-tab="stats" class="active" data-i18n="tab_stats">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
  <button data-tab="weapons" data-i18n="tab_weapons">–û—Ä—É–∂–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
  <button data-tab="magic" data-i18n="tab_magic">–ú–∞–≥–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
  <button data-tab="equipment" data-i18n="tab_equipment">–°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
  <button data-tab="description" data-i18n="tab_description">–û–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
  <button data-tab="notes" data-i18n="tab_notes">–ó–∞–º–µ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
</div>

<div id="tab_stats" class="tab-content"></div>
<div id="tab_weapons" class="tab-content"></div>
<div id="tab_magic" class="tab-content"></div>
<div id="tab_equipment" class="tab-content"></div>
<div id="tab_description" class="tab-content"></div>
<div id="tab_notes" class="tab-content"></div>

<script>
const buttons = document.querySelectorAll(".tabs button");
const containers = document.querySelectorAll(".tab-content");
const loadedScripts = new Set();

// ====== –ú–û–í–ê (–ì–õ–û–ë–ê–õ–¨–ù–ê) ======
window.currentLang = localStorage.getItem("sheet_lang") || "ru";

const translations = {
  ua: {
    tab_stats: "–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
    tab_weapons: "–û–∑–±—Ä–æ—î–Ω–Ω—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
    tab_magic: "–ú–∞–≥—ñ—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
    tab_equipment: "–°–ø–æ—Ä—è–¥–∂–µ–Ω–Ω—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
    tab_description: "–û–ø–∏—Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
    tab_notes: "–ù–æ—Ç–∞—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
    export: "üì§ –ï–∫—Å–ø–æ—Ä—Ç",
    import: "üì• –Ü–º–ø–æ—Ä—Ç"
  },
  ru: {
    tab_stats: "–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
    tab_weapons: "–û—Ä—É–∂–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
    tab_magic: "–ú–∞–≥–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
    tab_equipment: "–°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
    tab_description: "–û–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
    tab_notes: "–ó–∞–º–µ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
    export: "üì§ –≠–∫—Å–ø–æ—Ä—Ç",
    import: "üì• –ò–º–ø–æ—Ä—Ç"
  }
};

function applyLangToIndex(){
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    const key = el.dataset.i18n;
    if(translations[currentLang][key]){
      el.textContent = translations[currentLang][key];
    }
  });

  document.getElementById("exportBtn").textContent = translations[currentLang].export;
  document.getElementById("importBtn").textContent = translations[currentLang].import;
}

function setLang(lang){
  window.currentLang = lang;
  localStorage.setItem("sheet_lang", lang);
  applyLangToIndex();

  // –†–û–ó–°–ò–õ–ê–Ñ–ú–û –°–ò–ì–ù–ê–õ –£–°–Ü–ú –í–ö–õ–ê–î–ö–ê–ú
  document.dispatchEvent(new CustomEvent("langChanged", {detail: lang}));
}

// ====== –í–ö–õ–ê–î–ö–ò (–ë–ï–ó –ó–ú–Ü–ù) ======
buttons.forEach(btn=>{
  btn.addEventListener("click", async ()=>{
    buttons.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");

    containers.forEach(c=>c.style.display="none");

    const tab = btn.dataset.tab;
    const container = document.getElementById("tab_"+tab);
    container.style.display="block";

    if(!container.dataset.loaded){
      const html = await fetch(tab + ".html").then(r=>r.text());
      container.innerHTML = html;
      container.dataset.loaded = "true";

      if(!loadedScripts.has(tab)){
        const script = document.createElement("script");
        script.src = tab + ".js";
        document.body.appendChild(script);
        loadedScripts.add(tab);
      }
    }
  });
});

// –°—Ç–∞—Ä—Ç
applyLangToIndex();
document.querySelector('[data-tab="stats"]').click();

/* ========== –Ü–ú–ü–û–†–¢ / –ï–ö–°–ü–û–†–¢ (–ë–ï–ó –ó–ú–Ü–ù) ========== */
document.getElementById("exportBtn").addEventListener("click", ()=>{
  const data = {};
  for(let i=0; i<localStorage.length; i++){
    const key = localStorage.key(i);
    data[key] = localStorage.getItem(key);
  }
  const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "owlbear_sheet_backup.json";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
});

document.getElementById("importBtn").addEventListener("click", ()=>{
  document.getElementById("importFile").click();
});

document.getElementById("importFile").addEventListener("change", (e)=>{
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(event){
    try{
      const data = JSON.parse(event.target.result);
      localStorage.clear();
      Object.keys(data).forEach(key=>{
        localStorage.setItem(key, data[key]);
      });
      alert("–Ü–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂ —Å—Ç–æ—Ä—ñ–Ω–∫—É.");
    }catch(err){
      alert("–ü–æ–º–∏–ª–∫–∞ —Ñ–∞–π–ª—É! –ü–æ—Ç—Ä—ñ–±–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π JSON.");
    }
  };
  reader.readAsText(file);
});
</script>

</body>
</html>
