<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<style>
:root{
  --bg:#1e1e1e;
  --panel:#252525;
  --border:#555;
  --text:#e6e6e6;
  --muted:#aaa;
  --accent:#4fa3ff;
}

/* ===== БАЗА ===== */
body{
  margin:0;
  font-family: Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
  font-size:14px;
}

.sheet{
  padding:10px;
  max-width:900px;
  margin:auto;
}

/* ===== ПОЛЯ ВВОДА (ПОЛУПРОЗРАЧНЫЕ И СОХРАНЯЕМЫЕ) ===== */
input, select{
  background:rgba(255,255,255,0.15);
  color:white;
  border:1px solid var(--border);
  border-radius:4px;
  padding:4px;
}

input[type=number]{ width:60px; }

.small{ width:80px; }
.mid{ width:140px; }
.large{ width:220px; }

/* ===== ШАПКА ===== */
.top-row{
  display:grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  gap:8px;
  margin-bottom:10px;
}

/* ===== БЛОКИ HP / AC / MOVE / INIT ===== */
.stats-bar{
  display:grid;
  grid-template-columns: repeat(7,1fr);
  gap:8px;
  margin-bottom:12px;
  padding:8px;
  border:1px solid var(--border);
  border-radius:6px;
  background:var(--panel);
}

/* ===== ДВЕ КОЛОНКИ ===== */
.columns{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:40px; /* Правая колонка чуть дальше */
}

/* ===== РАМКИ ХАРАКТЕРИСТИК ===== */
.attr-frame{
  border:1px solid var(--border);
  border-radius:6px;
  padding:8px;
  margin-bottom:10px;
  background:var(--panel);
}

.attr-header{
  display:flex;
  align-items:center;
  gap:6px;
}

/* квадрат + прямоугольник модификатора */
.attr-box{
  display:flex;
  align-items:center;
}
.attr-box input{
  text-align:center;
}
.attr-box .val{
  width:50px;
  height:50px;
  font-size:18px;
}
.attr-box .mod{
  width:50px;
  height:30px;
  border-left:none;
}

/* ===== КРУЖКИ ПРОФЫ ===== */
.circle{
  width:16px;
  height:16px;
  border:1px solid var(--border);
  border-radius:50%;
  cursor:pointer;
  display:inline-block;
  margin-left:6px;
}
.circle.filled{
  background:var(--accent);
}

/* ===== СПАСБРОСКИ И НАВЫКИ ===== */
.save, .skill{
  display:flex;
  align-items:center;
  gap:6px;
  margin-top:6px;
}

.skill-list{
  margin-top:6px;
  margin-left:10px;
}

.skill-list .skill{
  margin-top:8px; /* чуть больше расстояние */
}

/* ===== ПАССИВНЫЕ ===== */
.passive-frame{
  border:1px solid var(--border);
  border-radius:6px;
  padding:8px;
  background:var(--panel);
}

/* ===== ИНИЦИАТИВА И ВДОХНОВЕНИЕ ===== */
.init-insp{
  display:flex;
  align-items:center;
  gap:10px;
}
.insp-box{
  display:flex;
  align-items:center;
  gap:4px;
}
</style>
</head>

<body>
<div class="sheet">

<!-- ===== ШАПКА ===== -->
<div class="top-row">
  <div>Имя: <input id="name" class="large"></div>
  <div>Класс: <input id="class" class="mid"></div>
  <div>Подкласс: <input id="subclass" class="mid"></div>
  <div>Раса: <input id="race" class="mid"></div>
</div>

<!-- ===== УРОВЕНЬ ===== -->
<div style="margin-bottom:10px;">
  Уровень:
  <select id="level"></select>
  Бонус мастерства: <span id="profBonus">+2</span>
</div>

<!-- ===== HP / AC / MOVE / INIT ===== -->
<div class="stats-bar">
  <div>ХП: <input type="number" id="hp"></div>
  <div>Макс ХП: <input type="number" id="maxHp"></div>
  <div>Врем. ХП: <input type="number" id="tempHp"></div>
  <div>Броня: <input type="number" id="ac"></div>
  <div>Перемещение: <input type="number" id="move"></div>
  <div>Перемещение в воде: <input type="number" id="swim"></div>

  <div class="init-insp">
    Инициатива: <span id="initiative">+0</span>
    <div class="insp-box">
      <input type="checkbox" id="inspiration"> Вдохновение
    </div>
  </div>
</div>

<!-- ===== КОЛОНКИ ===== -->
<div class="columns">

<!-- ===== ЛЕВАЯ КОЛОНКА ===== -->
<div>

<!-- СИЛА -->
<div class="attr-frame" id="strFrame">
  <div class="attr-header">
    <b>Сила</b>
    <div class="attr-box">
      <input type="number" class="val" id="str">
      <input type="text" class="mod" id="strMod" readonly>
    </div>
  </div>

  <div class="save">
    Спасбросок Силы: <span id="strSave">0</span>
    <div class="circle" data-target="strSave"></div>
  </div>

  <div class="skill-list">
    <div class="skill">Атлетика: <span id="athletics">0</span>
      <div class="circle" data-target="athletics"></div>
    </div>
  </div>
</div>

<!-- ИНТЕЛЛЕКТ -->
<div class="attr-frame" id="intFrame">
  <div class="attr-header">
    <b>Интеллект</b>
    <div class="attr-box">
      <input type="number" class="val" id="int">
      <input type="text" class="mod" id="intMod" readonly>
    </div>
  </div>

  <div class="save">
    Спасбросок Интеллекта: <span id="intSave">0</span>
    <div class="circle" data-target="intSave"></div>
  </div>

  <div class="skill-list">
    <div class="skill">Анализ: <span id="investigation">0</span>
      <div class="circle" data-target="investigation"></div>
    </div>
    <div class="skill">История: <span id="history">0</span>
      <div class="circle" data-target="history"></div>
    </div>
    <div class="skill">Магия: <span id="arcana">0</span>
      <div class="circle" data-target="arcana"></div>
    </div>
    <div class="skill">Природа: <span id="nature">0</span>
      <div class="circle" data-target="nature"></div>
    </div>
    <div class="skill">Религия: <span id="religion">0</span>
      <div class="circle" data-target="religion"></div>
    </div>
  </div>
</div>

<!-- ХАРИЗМА -->
<div class="attr-frame" id="chaFrame">
  <div class="attr-header">
    <b>Харизма</b>
    <div class="attr-box">
      <input type="number" class="val" id="cha">
      <input type="text" class="mod" id="chaMod" readonly>
    </div>
  </div>

  <div class="save">
    Спасбросок Харизмы: <span id="chaSave">0</span>
    <div class="circle" data-target="chaSave"></div>
  </div>

  <div class="skill-list">
    <div class="skill">Выступление: <span id="performance">0</span>
      <div class="circle" data-target="performance"></div>
    </div>
    <div class="skill">Запугивание: <span id="intimidation">0</span>
      <div class="circle" data-target="intimidation"></div>
    </div>
    <div class="skill">Обман: <span id="deception">0</span>
      <div class="circle" data-target="deception"></div>
    </div>
    <div class="skill">Убеждение: <span id="persuasion">0</span>
      <div class="circle" data-target="persuasion"></div>
    </div>
  </div>
</div>
</div>

<!-- ===== ПРАВАЯ КОЛОНКА ===== -->
<div>

<!-- ЛОВКОСТЬ -->
<div class="attr-frame" id="dexFrame">
  <div class="attr-header">
    <b>Ловкость</b>
    <div class="attr-box">
      <input type="number" class="val" id="dex">
      <input type="text" class="mod" id="dexMod" readonly>
    </div>
  </div>

  <div class="save">
    Спасбросок Ловкости: <span id="dexSave">0</span>
    <div class="circle" data-target="dexSave"></div>
  </div>

  <div class="skill-list">
    <div class="skill">Акробатика: <span id="acrobatics">0</span>
      <div class="circle" data-target="acrobatics"></div>
    </div>
    <div class="skill">Ловкость рук: <span id="sleight">0</span>
      <div class="circle" data-target="sleight"></div>
    </div>
    <div class="skill">Скрытность: <span id="stealth">0</span>
      <div class="circle" data-target="stealth"></div>
    </div>
  </div>
</div>

<!-- ТЕЛОСЛОЖЕНИЕ -->
<div class="attr-frame" id="conFrame">
  <div class="attr-header">
    <b>Телосложение</b>
    <div class="attr-box">
      <input type="number" class="val" id="con">
      <input type="text" class="mod" id="conMod" readonly>
    </div>
  </div>

  <div class="save">
    Спасбросок Телосложения: <span id="conSave">0</span>
    <div class="circle" data-target="conSave"></div>
  </div>
</div>

<!-- МУДРОСТЬ -->
<div class="attr-frame" id="wisFrame">
  <div class="attr-header">
    <b>Мудрость</b>
    <div class="attr-box">
      <input type="number" class="val" id="wis">
      <input type="text" class="mod" id="wisMod" readonly>
    </div>
  </div>

  <div class="save">
    Спасбросок Мудрости: <span id="wisSave">0</span>
    <div class="circle" data-target="wisSave"></div>
  </div>

  <div class="skill-list">
    <div class="skill">Восприятие: <span id="perception">0</span>
      <div class="circle" data-target="perception"></div>
    </div>
    <div class="skill">Выживание: <span id="survival">0</span>
      <div class="circle" data-target="survival"></div>
    </div>
    <div class="skill">Медицина: <span id="medicine">0</span>
      <div class="circle" data-target="medicine"></div>
    </div>
    <div class="skill">Проницательность: <span id="insight">0</span>
      <div class="circle" data-target="insight"></div>
    </div>
    <div class="skill">Уход за животными: <span id="animal">0</span>
      <div class="circle" data-target="animal"></div>
    </div>
  </div>
</div>

<!-- ПАССИВНЫЕ -->
<div class="passive-frame">
  <b>Пассивные</b>
  <div>Мудрость (Восприятие): <span id="passPer"></span></div>
  <div>Мудрость (Проницательность): <span id="passIns"></span></div>
  <div>Интеллект (Анализ): <span id="passInv"></span></div>
</div>

</div>
</div>
</div>

<script>
// ===== УРОВЕНЬ -> БОНУС МАСТЕРСТВА =====
const profByLevel = [2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6];

const fields = [
"name","class","subclass","race",
"hp","maxHp","tempHp","ac","move","swim",
"str","dex","con","int","wis","cha","inspiration"
];

const skillTargets = [
"strSave","dexSave","conSave","intSave","wisSave","chaSave",
"athletics","acrobatics","sleight","stealth",
"investigation","history","arcana","nature","religion",
"perception","survival","medicine","insight","animal",
"performance","intimidation","deception","persuasion"
];

const KEY = "owlbear-sheet-data";

// ===== ИНИЦИАЛИЗАЦИЯ УРОВНЕЙ =====
const levelSel = document.getElementById("level");
for(let i=1;i<=20;i++){
  let o=document.createElement("option");
  o.value=i; o.text=i;
  levelSel.appendChild(o);
}
levelSel.value = 1;

// ===== МОДИФИКАТОР =====
function mod(v){
  v = parseInt(v)||0;
  return Math.floor((v-10)/2);
}

// ===== СОХРАНЕНИЕ =====
function saveAll(){
  const data = {};
  fields.forEach(f=>{
    const el = document.getElementById(f);
    if(el.type==="checkbox") data[f] = el.checked;
    else data[f] = el.value;
  });
  // сохраняем кружки
  document.querySelectorAll(".circle").forEach(c=>{
    data["circ_"+c.dataset.target] = c.classList.contains("filled") ?
      (c.dataset.state||0) : 0;
  });

  localStorage.setItem(KEY, JSON.stringify(data));
}

// ===== ЗАГРУЗКА =====
function loadAll(){
  const raw = localStorage.getItem(KEY);
  if(!raw) return;
  const data = JSON.parse(raw);

  fields.forEach(f=>{
    const el = document.getElementById(f);
    if(el.type==="checkbox") el.checked = !!data[f];
    else if(data[f]!==undefined) el.value = data[f];
  });

  document.querySelectorAll(".circle").forEach(c=>{
    const st = data["circ_"+c.dataset.target];
    if(st){
      c.classList.add("filled");
      c.dataset.state = st;
    }
  });
}

// ===== ОБНОВЛЕНИЕ ВСЕГО =====
function recalc(){
  const lvl = parseInt(levelSel.value)||1;
  const prof = profByLevel[lvl-1];
  document.getElementById("profBonus").textContent = "+"+prof;

  const STR = mod(str.value);
  const DEX = mod(dex.value);
  const CON = mod(con.value);
  const INT = mod(int.value);
  const WIS = mod(wis.value);
  const CHA = mod(cha.value);

  strMod.value = (STR>=0?"+":"")+STR;
  dexMod.value = (DEX>=0?"+":"")+DEX;
  conMod.value = (CON>=0?"+":"")+CON;
  intMod.value = (INT>=0?"+":"")+INT;
  wisMod.value = (WIS>=0?"+":"")+WIS;
  chaMod.value = (CHA>=0?"+":"")+CHA;

  // Инициатива
  document.getElementById("initiative").textContent =
    (DEX>=0?"+":"")+DEX;

  // БАЗЫ
  const bases = {
    strSave:STR, dexSave:DEX, conSave:CON,
    intSave:INT, wisSave:WIS, chaSave:CHA,

    athletics:STR,
    acrobatics:DEX, sleight:DEX, stealth:DEX,
    investigation:INT, history:INT, arcana:INT, nature:INT, religion:INT,
    perception:WIS, survival:WIS, medicine:WIS, insight:WIS, animal:WIS,
    performance:CHA, intimidation:CHA, deception:CHA, persuasion:CHA
  };

  // ПРИМЕНЯЕМ БОНУСЫ (0 / +prof / +2prof)
  skillTargets.forEach(t=>{
    let base = bases[t] ?? 0;
    const el = document.getElementById(t);
    const circle = document.querySelector(`.circle[data-target="${t}"]`);
    const st = parseInt(circle.dataset.state||0);

    let total = base + st*prof;
    el.textContent = (total>=0?"+":"")+total;
  });

  // ПАССИВНЫЕ
  const hasProf = (t)=> {
    const c = document.querySelector(`.circle[data-target="${t}"]`);
    return (parseInt(c.dataset.state||0)>0);
  };

  document.getElementById("passPer").textContent =
    10 + WIS + (hasProf("perception")?prof:0);

  document.getElementById("passIns").textContent =
    10 + WIS + (hasProf("insight")?prof:0);

  document.getElementById("passInv").textContent =
    10 + INT + (hasProf("investigation")?prof:0);

  saveAll();
}

// ===== КЛИК ПО КРУЖКАМ (0 → 1 → 2 → 0) =====
document.querySelectorAll(".circle").forEach(c=>{
  c.addEventListener("click",()=>{
    let s = parseInt(c.dataset.state||0);
    s = (s+1)%3; // 0,1,2,0...
    c.dataset.state = s;
    if(s===0) c.classList.remove("filled");
    else c.classList.add("filled");
    recalc();
  });
});

// ===== СЛУШАТЕЛИ =====
document.querySelectorAll("input,select").forEach(el=>{
  el.addEventListener("input",recalc);
});

// ЗАГРУЗКА ПРИ СТАРТЕ
loadAll();
recalc();
</script>
</body>
</html>
