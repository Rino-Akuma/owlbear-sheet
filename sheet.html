<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Owlbear Sheet – D&D 5e RU</title>
<style>
body{
    font-family: Arial, sans-serif;
    background:#f2f2f2;
    margin:0;
    padding:10px;
}
.sheet{
    max-width:1000px;
    margin:auto;
    display:flex;
    flex-direction:column;
    gap:8px;
}
.row{display:flex; gap:8px; flex-wrap:wrap;}
.block{
    padding:8px;
    border-radius:6px;
    margin-bottom:8px;
    background:rgba(255,255,255,0.7);
}
.column{display:flex; flex-direction:column; gap:4px;}
input{
    padding:4px;
    border-radius:4px;
    border:1px solid #999;
    background:rgba(255,255,255,0.7);
}
.small{width:60px;}
.stat-frame{
    border:1px solid #666;
    border-radius:6px;
    padding:6px;
    margin-bottom:6px;
    display:flex;
    flex-direction:column;
    gap:4px;
    background:rgba(255,255,255,0.6);
}
.stat-top{
    display:flex;
    gap:4px;
    align-items:center;
}
.stat-square{
    width:50px;
    height:50px;
    border:1px solid #333;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:bold;
}
.stat-rect{
    width:50px;
    height:30px;
    border-top:1px solid #333;
    display:flex;
    align-items:center;
    justify-content:center;
    margin-left:-1px;
}
.skill, .save{
    display:flex; align-items:center; gap:6px;
    padding-left:6px;
    margin-bottom:4px;
}
.circle{
    width:18px;
    height:18px;
    border:1px solid black;
    border-radius:50%;
    cursor:pointer;
    display:inline-block;
}
.circle.filled{background:black;}
.passive-frame{
    border:1px solid #666;
    border-radius:6px;
    padding:6px;
    margin-top:12px;
    background:rgba(255,255,255,0.6);
}
.left-block{flex:1; display:flex; flex-direction:column; gap:8px;}
.right-block{flex:1; display:flex; flex-direction:column; gap:8px; margin-left:30px;}
.armor-row{display:flex; gap:8px; align-items:center; flex-wrap:wrap;}
</style>
</head>
<body>

<div class="sheet">

<h3>Персонаж</h3>
<div class="row block">
  <div class="column"><label>Имя</label><input id="name"></div>
  <div class="column"><label>Класс</label><input id="class"></div>
  <div class="column"><label>Подкласс</label><input id="subclass"></div>
  <div class="column"><label>Раса</label><input id="race"></div>
  <div class="column"><label>Уровень</label><input id="level" type="number" value="1" min="1" max="20" class="small" onchange="updatePB()"></div>
  <div class="column"><label>Бонус мастерства</label><input id="pb" class="small" readonly></div>
</div>

<h3>ХП, броня и переміщення</h3>
<div class="row block armor-row">
  <div class="column"><label>Текущие ХП</label><input id="hp" class="small"></div>
  <div class="column"><label>Макс ХП</label><input id="maxhp" class="small"></div>
  <div class="column"><label>Временные ХП</label><input id="temphp" class="small"></div>
  <div class="column"><label>Броня (AC)</label><input id="ac" class="small"></div>
  <div class="column"><label>Переміщення</label><input id="move" class="small"></div>
  <div class="column"><label>Переміщення у воді</label><input id="swim" class="small"></div>
</div>

<h3>Характеристики, спаскидки та навички</h3>
<div class="row">
  <div class="left-block" id="left-stats"></div>
  <div class="right-block" id="right-stats"></div>
</div>

<h3>Пасивні навички</h3>
<div class="passive-frame">
  <div>Мудрость (Восприятие): <span id="passPer">10</span></div>
  <div>Мудрость (Проницательность): <span id="passIns">10</span></div>
  <div>Интеллект (Анализ): <span id="passInv">10</span></div>
</div>

</div>

<script>
const stats=["Сила","Интеллект","Харизма","Ловкость","Мудрость","Телосложение"];
const skills={
 "Сила":["Атлетика"],
 "Ловкость":["Акробатика","Ловкость рук","Скрытность"],
 "Телосложение":[],
 "Интеллект":["Анализ","История","Магия","Природа","Религия"],
 "Мудрость":["Восприятие","Выживание","Медицина","Проницательность","Уход за животными"],
 "Харизма":["Выступление","Запугивание","Обман","Убеждение"]
};
const pbTable={1:2,2:2,3:2,4:2,5:3,6:3,7:3,8:3,9:4,10:4,11:4,12:4,13:5,14:5,15:5,16:5,17:6,18:6,19:6,20:6};
function mod(v){return Math.floor((v-10)/2);}

// localStorage
function saveData(){localStorage.setItem("sheetData",JSON.stringify(getAllData()));}
function loadData(){let d=JSON.parse(localStorage.getItem("sheetData")||"{}");setAllData(d);}

function updatePB(){let lvl=parseInt(document.getElementById("level").value||1);document.getElementById("pb").value=pbTable[lvl]||2;recalcAll();saveData();}

function toggleCircle(el){el.dataset.state=el.dataset.state=="1"?"0":"1";el.classList.toggle("filled");recalcAll();saveData();}

function recalcAll(){
  let pb=parseInt(document.getElementById("pb").value||2);
  stats.forEach(s=>{
    let val=parseInt(document.getElementById(s+"_val").value||10);
    document.getElementById(s+"_mod").innerText=(mod(val)>=0?"+":"")+mod(val);
  });
  stats.forEach(s=>{
    let base=mod(parseInt(document.getElementById(s+"_val").value||10));
    let circle=document.getElementById("save_"+s);
    let bonus=circle.dataset.state=="1"?pb:0;
    document.getElementById("save_res_"+s).innerText=(base+bonus>=0?"+":"")+(base+bonus);
  });
  Object.keys(skills).forEach(stat=>skills[stat].forEach(skill=>{
    let base=mod(parseInt(document.getElementById(stat+"_val").value||10));
    let circle=document.getElementById("skill_"+skill);
    let bonus=circle.dataset.state=="1"?pb:0;
    document.getElementById("skill_res_"+skill).innerText=(base+bonus>=0?"+":"")+(base+bonus);
  }));
  let wisMod=mod(parseInt(document.getElementById("Мудрость_val").value||10));
  let intMod=mod(parseInt(document.getElementById("Интеллект_val").value||10));
  document.getElementById("passPer").innerText=10+wisMod+(document.getElementById("skill_Восприятие").dataset.state=="1"?pb:0);
  document.getElementById("passIns").innerText=10+wisMod+(document.getElementById("skill_Проницательность").dataset.state=="1"?pb:0);
  document.getElementById("passInv").innerText=10+intMod+(document.getElementById("skill_Анализ").dataset.state=="1"?pb:0);
}

// Генерація рамок
function createStatFrame(s){
  let html=`<div class="stat-frame">
    <div class="stat-top">
      <div class="stat-square"><input id="${s}_val" type="number" value="10" style="width:100%;border:none;text-align:center;background:none;" onchange="recalcAll();saveData()"></div>
      <div class="stat-rect" id="${s}_mod">+0</div>
    </div>
    <div class="save"><div class="circle" id="save_${s}" data-state="0" onclick="toggleCircle(this)"></div> <div id="save_res_${s}">+0</div></div>`;
  skills[s].forEach(sk=>html+=`<div class="skill"><div class="circle" id="skill_${sk}" data-state="0" onclick="toggleCircle(this)"></div> ${sk} <div id="skill_res_${sk}">+0</div></div>`);
  html+="</div>"; return html;
}

let left=document.getElementById("left-stats");
let right=document.getElementById("right-stats");
["Сила","Интеллект","Харизма"].forEach(s=>left.innerHTML+=createStatFrame(s));
["Ловкость","Мудрость","Телосложение"].forEach(s=>right.innerHTML+=createStatFrame(s));

function getAllData(){
  let data={};
  ["name","class","subclass","race","level","pb","hp","maxhp","temphp","ac","move","swim"].forEach(id=>data[id]=document.getElementById(id).value);
  stats.forEach(s=>{data[s+"_val"]=document.getElementById(s+"_val").value;data["save_"+s]=document.getElementById("save_"+s).dataset.state;});
  Object.keys(skills).forEach(stat=>skills[stat].forEach(sk=>{data["skill_"+sk]=document.getElementById("skill_"+sk).dataset.state;}));
  return data;
}

function setAllData(d){
  ["name","class","subclass","race","level","pb","hp","maxhp","temphp","ac","move","swim"].forEach(id=>{if(d[id]!=undefined)document.getElementById(id).value=d[id];});
  stats.forEach(s=>{
    if(d[s+"_val"]!=undefined)document.getElementById(s+"_val").value=d[s+"_val"];
    if(d["save_"+s]!=undefined){document.getElementById("save_"+s).dataset.state=d["save_"+s];document.getElementById("save_"+s).classList.toggle("filled",d["save_"+s]=="1");}
  });
  Object.keys(skills).forEach(stat=>skills[stat].forEach(sk=>{
    if(d["skill_"+sk]!=undefined){document.getElementById("skill_"+sk).dataset.state=d["skill_"+sk];document.getElementById("skill_"+sk).classList.toggle("filled",d["skill_"+sk]=="1");}
  }));
  recalcAll();
}

loadData();
updatePB();
</script>
</body>
</html>
