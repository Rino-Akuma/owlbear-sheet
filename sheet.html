<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
body{
  font-family: Arial, sans-serif;
  background:#1e1f22;
  color:#e6e6e6;
  padding:8px;
}

/* ======= HEADER ======= */
.header{
  display:grid;
  grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr;
  gap:6px;
  margin-bottom:10px;
}
.field{
  background:#2b2d31;
  border:1px solid #444;
  padding:4px;
  border-radius:6px;
}
.field label{font-size:11px; opacity:.8;}
.field input{
  width:100%;
  background:rgba(255,255,255,0.15);
  color:white;
  border:1px solid #555;
  border-radius:4px;
}

/* ======= STATS LAYOUT ======= */
.container{
  display:grid;
  grid-template-columns: 1fr 0.8fr 1fr;
  gap:16px;
}

/* Колонки */
.col{display:flex; flex-direction:column; gap:10px;}

/* Рамка блока характеристики */
.stat-box{
  border:1px solid #666;
  border-radius:8px;
  padding:6px;
  background:#24262a;
}

/* Назва характеристики */
.stat-title{
  text-align:center;
  font-weight:bold;
  margin-bottom:4px;
}

/* Квадрат + прямокутник модифікатора */
.stat-top{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:0;
}
.stat-val{
  width:48px;
  height:48px;
  text-align:center;
  font-size:22px;
  background:rgba(255,255,255,0.15);
  border:1px solid #777;
}
.stat-mod{
  width:40px;
  height:48px;
  text-align:center;
  font-size:18px;
  background:rgba(255,255,255,0.15);
  border:1px solid #777;
  border-left:none;
}

/* Кругляшки */
.dot{
  width:16px;
  height:16px;
  border:1px solid #aaa;
  border-radius:50%;
  display:inline-block;
  cursor:pointer;
  margin-right:4px;
}
.dot.filled{background:#7dd3fc;}

/* Список спасків і навичок */
.list{
  margin-top:6px;
  font-size:13px;
}
.row{
  display:flex;
  align-items:center;
  gap:6px;
  margin:6px 0;
}

/* Число навику */
.skill-num{
  width:24px;
  text-align:right;
  font-weight:bold;
}

/* Пасивні навички */
.passive-box{
  border:1px solid #666;
  border-radius:8px;
  padding:6px;
  background:#24262a;
}
</style>
</head>
<body>

<h3>Лист персонажа</h3>

<div class="header">
  <div class="field">
    <label>Имя</label>
    <input id="name">
  </div>
  <div class="field">
    <label>Класс</label>
    <input id="class">
  </div>
  <div class="field">
    <label>Подкласс</label>
    <input id="subclass">
  </div>
  <div class="field">
    <label>Раса</label>
    <input id="race">
  </div>
  <div class="field">
    <label>Уровень</label>
    <input id="level" type="number" min="1" value="1">
  </div>
  <div class="field">
    <label>Бонус мастерства</label>
    <input id="pb" readonly>
  </div>
</div>

<div class="header">
  <div class="field">
    <label>Текущие ХП</label>
    <input id="hp" type="number">
  </div>
  <div class="field">
    <label>Макс ХП</label>
    <input id="maxhp" type="number">
  </div>
  <div class="field">
    <label>Временные ХП</label>
    <input id="temphp" type="number">
  </div>
  <div class="field">
    <label>Броня (AC)</label>
    <input id="ac" type="number">
  </div>
  <div class="field">
    <label>Перемещение</label>
    <input id="move" type="number">
  </div>
  <div class="field">
    <label>Перемещение в воде</label>
    <input id="swim" type="number">
  </div>
</div>

<div class="container">

<!-- ====== ЛЕВА КОЛОНКА ====== -->
<div class="col">

<!-- СИЛА -->
<div class="stat-box">
  <div class="stat-title">Сила</div>
  <div class="stat-top">
    <input id="str_val" class="stat-val" type="number">
    <input id="str_mod" class="stat-mod" readonly>
  </div>
  <div class="list">
    <div class="row"><span id="save_str" class="dot"></span> Спасбросок Силы</div>
    <div class="row">
      <span id="skill_athletics" class="dot"></span>
      <span class="skill-num" id="num_athletics">0</span>
      Атлетика
    </div>
  </div>
</div>

<!-- ИНТЕЛЛЕКТ -->
<div class="stat-box">
  <div class="stat-title">Интеллект</div>
  <div class="stat-top">
    <input id="int_val" class="stat-val" type="number">
    <input id="int_mod" class="stat-mod" readonly>
  </div>
  <div class="list">
    <div class="row"><span id="save_int" class="dot"></span> Спасбросок Интеллекта</div>

    <div class="row"><span id="skill_arcana" class="dot"></span>
      <span class="skill-num" id="num_arcana">0</span> Магия</div>

    <div class="row"><span id="skill_history" class="dot"></span>
      <span class="skill-num" id="num_history">0</span> История</div>

    <div class="row"><span id="skill_nature" class="dot"></span>
      <span class="skill-num" id="num_nature">0</span> Природа</div>

    <div class="row"><span id="skill_religion" class="dot"></span>
      <span class="skill-num" id="num_religion">0</span> Религия</div>

    <div class="row"><span id="skill_investigation" class="dot"></span>
      <span class="skill-num" id="num_investigation">0</span> Анализ</div>
  </div>
</div>

<!-- ХАРИЗМА -->
<div class="stat-box">
  <div class="stat-title">Харизма</div>
  <div class="stat-top">
    <input id="cha_val" class="stat-val" type="number">
    <input id="cha_mod" class="stat-mod" readonly>
  </div>
  <div class="list">
    <div class="row"><span id="save_cha" class="dot"></span> Спасбросок Харизмы</div>

    <div class="row"><span id="skill_deception" class="dot"></span>
      <span class="skill-num" id="num_deception">0</span> Обман</div>

    <div class="row"><span id="skill_intimidation" class="dot"></span>
      <span class="skill-num" id="num_intimidation">0</span> Запугивание</div>

    <div class="row"><span id="skill_performance" class="dot"></span>
      <span class="skill-num" id="num_performance">0</span> Выступление</div>

    <div class="row"><span id="skill_persuasion" class="dot"></span>
      <span class="skill-num" id="num_persuasion">0</span> Убеждение</div>
  </div>
</div>
</div>

<!-- СЕРЕДИНА -->
<div></div>

<!-- ====== ПРАВА КОЛОНКА ====== -->
<div class="col">

<!-- ЛОВКОСТЬ -->
<div class="stat-box">
  <div class="stat-title">Ловкость</div>
  <div class="stat-top">
    <input id="dex_val" class="stat-val" type="number">
    <input id="dex_mod" class="stat-mod" readonly>
  </div>
  <div class="list">
    <div class="row"><span id="save_dex" class="dot"></span> Спасбросок Ловкости</div>

    <div class="row"><span id="skill_acrobatics" class="dot"></span>
      <span class="skill-num" id="num_acrobatics">0</span> Акробатика</div>

    <div class="row"><span id="skill_sleight" class="dot"></span>
      <span class="skill-num" id="num_sleight">0</span> Ловкость рук</div>

    <div class="row"><span id="skill_stealth" class="dot"></span>
      <span class="skill-num" id="num_stealth">0</span> Скрытность</div>
  </div>
</div>

<!-- МУДРОСТЬ -->
<div class="stat-box">
  <div class="stat-title">Мудрость</div>
  <div class="stat-top">
    <input id="wis_val" class="stat-val" type="number">
    <input id="wis_mod" class="stat-mod" readonly>
  </div>
  <div class="list">
    <div class="row"><span id="save_wis" class="dot"></span> Спасбросок Мудрости</div>

    <div class="row"><span id="skill_perception" class="dot"></span>
      <span class="skill-num" id="num_perception">0</span> Восприятие</div>

    <div class="row"><span id="skill_insight" class="dot"></span>
      <span class="skill-num" id="num_insight">0</span> Проницательность</div>

    <div class="row"><span id="skill_medicine" class="dot"></span>
      <span class="skill-num" id="num_medicine">0</span> Медицина</div>

    <div class="row"><span id="skill_survival" class="dot"></span>
      <span class="skill-num" id="num_survival">0</span> Выживание</div>

    <div class="row"><span id="skill_animal" class="dot"></span>
      <span class="skill-num" id="num_animal">0</span> Уход за животными</div>
  </div>
</div>

<!-- ПАССИВНЫЕ -->
<div class="passive-box">
  <div><b>Пассивные навыки</b></div>
  <div>Восприятие: <span id="pass_perception"></span></div>
  <div>Проницательность: <span id="pass_insight"></span></div>
  <div>Анализ: <span id="pass_investigation"></span></div>
</div>

</div>
</div>

<script>
const skillsByStat = {
  str: ["athletics"],
  dex: ["acrobatics","sleight","stealth"],
  int: ["arcana","history","nature","religion","investigation"],
  wis: ["perception","insight","medicine","survival","animal"],
  cha: ["deception","intimidation","performance","persuasion"]
};

// PB по уровню
function calcPB(lvl){
  if(lvl<=4) return 2;
  if(lvl<=8) return 3;
  if(lvl<=12) return 4;
  if(lvl<=16) return 5;
  return 6;
}

function mod(v){ return Math.floor((v-10)/2); }

// === СОХРАНЕНИЕ ===
function save(){
  let data = {};
  document.querySelectorAll("input").forEach(i=>data[i.id]=i.value);
  document.querySelectorAll(".dot").forEach(d=>data[d.id]=d.dataset.state||"0");
  localStorage.setItem("owlbear_sheet",JSON.stringify(data));
}

// === ЗАГРУЗКА ===
function load(){
  let d = JSON.parse(localStorage.getItem("owlbear_sheet")||"{}");

  document.querySelectorAll("input").forEach(i=>{
    if(d[i.id]!==undefined) i.value=d[i.id];
  });

  document.querySelectorAll(".dot").forEach(dot=>{
    dot.dataset.state = d[dot.id] || "0";
    dot.classList.toggle("filled", dot.dataset.state!="0");
  });

  recalc();
}

// === КРУГЛЯШКИ ===
document.querySelectorAll(".dot").forEach(dot=>{
  dot.onclick=()=>{
    if(dot.id.startsWith("save_")){
      dot.dataset.state = dot.dataset.state=="0"?"1":"0";
    } else {
      dot.dataset.state = (parseInt(dot.dataset.state)+1)%3;
    }
    dot.classList.toggle("filled", dot.dataset.state!="0");
    recalc(); save();
  }
});

// === ПЕРЕРАСЧЕТ ВСЕГО ===
function recalc(){
  let lvl = parseInt(level.value)||1;
  let pbv = calcPB(lvl);
  pb.value = pbv;

  // модифікатори характеристик
  ["str","dex","con","int","wis","cha"].forEach(s=>{
    let v = parseInt(document.getElementById(s+"_val").value)||10;
    document.getElementById(s+"_mod").value = mod(v);
  });

  // числа навичок
  for (let stat in skillsByStat){
    let m = mod(parseInt(document.getElementById(stat+"_val").value)||10);

    skillsByStat[stat].forEach(sk=>{
      let state = parseInt(document.getElementById("skill_"+sk).dataset.state||0);
      let total = m + state*pbv;
      document.getElementById("num_"+sk).textContent = total;
    });
  }

  // пассивные
  let wis = mod(parseInt(wis_val.value)||10);
  let intm = mod(parseInt(int_val.value)||10);

  pass_perception.textContent =
    10 + wis + (parseInt(skill_perception.dataset.state)>0 ? pbv:0);

  pass_insight.textContent =
    10 + wis + (parseInt(skill_insight.dataset.state)>0 ? pbv:0);

  pass_investigation.textContent =
    10 + intm + (parseInt(skill_investigation.dataset.state)>0 ? pbv:0);

  save();
}

// авто-сохранение
document.querySelectorAll("input").forEach(i=>{
  i.addEventListener("input", recalc);
});

load();
recalc();
</script>
</body>
</html>
